{% extends 'base.html' %}

{% load static %}

{% block title%}Προιόντα Κατηγορίας {% endblock %}

{%block css %}

{% endblock%}

{% block content %}
    {% include 'Component/page_title.html' with tab1='Υποκατηγορία' tab2=subcategory %}
    <!-- Product Table Header-->
      <div class="card has-table has-mobile-sort-spaced">
        <header class="card-header">
          <p class="card-header-title">
            <span class="icon"><i class="mdi {{category.icon}}"></i></span>
                - Προιόντα: {{num_products}}
          </p>
          <div class="control pt-1">
            <a href="{{ category.get_absolute_url }}" class="button is-info mr-2">Πίσω</a>

            <a href="#" class="button is-warning">
                <span class="icon mr-4"><i class="mdi mdi-cogs mdi-24px"></i></span>
                Τροποποίηση
            </a>
          </div>
        </header>
      </div>

    <!--Product Search-->
    <div class="card-content has-text-centered has-mobile">
        <form action="#"
              method="get"
              class="field is-grouped is-horizontal-mobile">

          <div class="control is-expanded ">
            <input class="input"  value = "{{ query }}" name="q" id="q"
                   type="text" placeholder="Search for products..">
          </div>
          <div class="control">
            <button class="button is-info" type='submit'><span>Search</span><span class="icon has-text-light is-large">
              <i class="mdi mdi-account-search "></i></span></button>
          </div>

          <div  class="control">
            <div class="select">
              <select name="search_option" >
                <option value="Επιχείρηση">Ονομα</option>
                <option value="SKU">SKU</option>
                <option value="Πόλη">Συσκευασια</option>
              </select>
            </div>
          </div>

          <div  class="control">
            <div class="select">
              <select name="search_filter" >
                <option value="Επιχείρηση">Διαθεσιμα</option>
                <option value="SKU">Ενεργα</option>
                <option value="Πόλη">Online</option>
              </select>
            </div>
          </div>

        </form>
    </div>

<!--    {% if request.resolver_match.url_name == 'supplier-search' %}-->
<!--    <div style="display: flex; justify-content: center; height: 100%;">-->
<!--      <div class="notification is-success">-->
<!--        {% if not products %}-->
<!--          Δεν βρέθηκαν αποτελέσματα προμηθευτών με {{search_option }}: {{query}}.-->
<!--        {% else %}-->
<!--          Bρέθηκαν {{suppliers|length}} προμηθευτες με {{search_option }}: {{query}}.-->
<!--        {% endif %}-->
<!--      </div>-->
<!--    </div>-->
<!--  {% endif %}-->

<div class="b-table has-pagination">
    <a href="{% url 'product:product-create' %}" class="button is-success ml-5">
                <span class="icon mr-4"><i class="mdi mdi-package-variant-closed mdi-24px"></i></span>
                Νέο Προιόν
            </a>
    <div class="table-wrapper has-mobile-cards">
      <table class="table is-fullwidth is-striped is-hoverable is-sortable is-fullwidth">
        <thead>
          <tr>
            <th>Προιoν</th>
            <th>SKU_num</th>
            <th>Συσκευασiα</th>
            <th>Διαθέσιμο</th>
            <th>Online</th>
            <th>Active</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for product in product_list %}
            <tr>
              <td data-label="Προιόν">{{product.product_name}}</td>
              <td data-label="SKU_num">{{product.sku_num}}</td>
              <td data-label="Συσκευασiα">{{product.package}}</td>
              <td data-label="Διαθέσιμο">
                {% if product.available %}
                  <span class="icon has-text-success ">
                    <i class="mdi mdi-check-decagram "></i>
                  </span>
                {% else %}
                    <span class="icon has-text-danger ">
                      <i class="mdi mdi-cancel "></i>
                    </span>
                {% endif %}
              </td>
              <td data-label="Online">
                {% if product.online_sell %}
                  <span class="icon has-text-success ">
                    <i class="mdi mdi-check-decagram "></i>
                  </span>
                {% else %}
                    <span class="icon has-text-danger ">
                      <i class="mdi mdi-cancel "></i>
                    </span>
                {% endif %}
              </td>
              <td data-label="Active">
                {% if product.is_active %}
                  <span class="icon has-text-success ">
                    <i class="mdi mdi-check-decagram "></i>
                  </span>
                {% else %}
                    <span class="icon has-text-danger ">
                      <i class="mdi mdi-cancel "></i>
                    </span>
                {% endif %}
              </td>
              <td class="is-actions-cell">
                <div class="buttons is-right">
                  <a href="#"
                     class="button is-small is-primary" type="button">
                    <span class="icon"><i class="mdi mdi-eye"></i></span>
                  </a>
                  <button class="button is-small is-danger jb-modal"
                          id="modal-{{ product.pk }}-trigger"  type="button">
                    <span class="icon"><i class="mdi mdi-trash-can"></i></span>

                  </button>
                  <!-- Modal -->
                  <div class="modal" id="delete-modal">
                    <div class="modal-background"></div>
                    <div class="modal-card">
                      <header class="modal-card-head">
                        <p class="modal-card-title">Delete Confirmation</p>
                        <button class="delete" aria-label="close"></button>
                      </header>
                      <section class="modal-card-body">
                        Are you sure you want to delete this item?
                      </section>
                      <footer class="modal-card-foot">
                        <form action="#"
                              method="post">
                          {% csrf_token %}
                          <input type="submit" value="Delete" class="button is-danger">
                          <a class="button" id="cancel-button">Cancel</a>
                        </form>
                      </footer>
                    </div>
                  </div>

                </div>
              </td>
                </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </div>
{% endblock %}

{% block js %}
  {% for product in product_list %}
    document.getElementById('modal-{{ product.pk }}-trigger').addEventListener('click', function() {
    var modal = document.getElementById('delete-modal');
    document.querySelector("#delete-modal form").action = "#";
    modal.classList.add('is-active');
    });
  {% endfor %}

  document.getElementById('cancel-button').addEventListener('click', function() {
    var modal = document.getElementById('delete-modal');
    modal.classList.remove('is-active');
  });
{% endblock %}
